<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>颜色转化</title>
  <style type="text/css">
    *{
      margin: 0;
      padding: 0;
      user-select: none;
    }

    #app{
      position: absolute;
      transform: translateX(-50%);
      top: 20%;
      left: 50%;
      width: 900px;
    }

    .item{
      width: 400px;
      height: 300px;
      border-radius: 10px;
      border: #808080 dashed 3px;
      float: left;
    }

    .title{
      width: 400px;
      height: 80px;
      font-size: 36px;
      line-height: 80px;
      text-align: center;
    }

    .shuRu{
      width: 250px;
      height: 50px;
      font-size: 28px;
      text-align: center;
      margin-left: 75px;
      border: 2px black solid;
      border-radius: 10px;
    }

    .result{
      cursor: pointer;
      width: 250px;
      margin-left: 75px;
    }

    .result_text{
      width: 250px;
      height: 40px;
      font-size: 24px;
      line-height: 40px;
      text-align: center;
    }

    .result_color{
      width: 150px;
      height: 50px;
      margin-left: 50px;
      background: #6495ED;
    }

    .waring{
      width: 200px;
      font-size: 18px;
      line-height: 25px;
      height: 25px;
      text-align: center;
      margin-left: 100px;
      color: red;
    }

    #alert_window{
      width: 350px;
      height: 50px;
      text-align: center;
      line-height: 50px;
      font-size: 28px;
      position: absolute;
      transform: translateX(-50%);
      display: none;
      margin-top: 50px;
      left: 50%;
    }
  </style>
</head>
<body>

<div id="alert_window">内容复制成功！</div>

<div id="app">
  <div class="item" id="rgbToColor">
    <div class="title">RGB转十六进制</div>
    <input type="text" class="shuRu" id="rgb_input" oninput="getOnInput('rgb_input', 0)">
    <div class="waring"></div>
    <div class="result" onclick="getResult(0)">
      <div class="result_text">#6495ED</div>
      <div class="result_color"></div>
    </div>
  </div>
  <div style="width: 50px; height: 300px; float: left"></div>
  <div class="item" id="colorToRGB">
    <div class="title">十六进制转RGB</div>
    <input type="text" class="shuRu" id="color_input" oninput="getOnInput('color_input', 1)">
    <div class="waring"></div>
    <div class="result" onclick="getResult(1)">
      <div class="result_text">100,149,237</div>
      <div class="result_color"></div>
    </div>
  </div>
</div>

<script type="text/javascript">
  // 表单数据双向绑定
  function getOnInput(id, index) {
    let val = document.getElementById(id).value;
    if (index == 0) {//RGB转十六进制
      if (isRGBLegal(val)) {
        document.getElementsByClassName("waring")[index].innerHTML = "";
        rgbToColor(val);
      } else if (val == "") {
        document.getElementsByClassName("waring")[index].innerHTML = "";
      } else {
        document.getElementsByClassName("waring")[index].innerHTML = "你输入的内容格式有误！";
      }
    } else if (index == 1) {//十六进制转RGB
      if (isColorLegal(val)) {
        document.getElementsByClassName("waring")[index].innerHTML = "";
        val = val.replace("#", "");
        val = val.replace(" ", "");
        colorToRGB(val);
      } else if (val == "") {
        document.getElementsByClassName("waring")[index].innerHTML = "";
      } else {
        document.getElementsByClassName("waring")[index].innerHTML = "你输入的内容格式有误！";
      }
    }
  }

  // 判断rgb中的数据是否合法
  function isRGBLegal(value) {
    let judge_list = ['0','1','2','3','4','5','6','7','8','9',',',' '];
    let list = value.split(',');
    if (list.length != 3) {return false;}
    for(let i = 0;i<list.length;i++) {
      if (list[i] == "") {return false;}
      if (list[i] == " ") {return false;}
      if (list[i] * 1 <0 || list[i] > 255) {return false;}
    }
    for(let i = 0;i<value.length;i++) {
      if (judge_list.indexOf(value[i]) == -1) {return false;}
    }
    return true;
  }

  // 判断color中的数据是否合法
  function isColorLegal(value) {
    let judge_list = ['0','1','2','3','4','5','6','7','8','9','a','b','c','d','e','f','A','B','C','D','E','F'];
    if (value[0] != "#") {return false;}
    value = value.replace("#", "");
    value = value.replace(" ", "");
    if (value.length != 3) {
      if (value.length != 6) {return false;}
    }
    for(let i = 0;i<value.length;i++) {
      if (judge_list.indexOf(value[i]) == -1) {return false;}
    }
    return true;
  }

  // RGB转十六进制
  function rgbToColor(value) {
    let result = "";
    let list = value.split(',');
    for(let i = 0;i<list.length;i++) {
      result += ("0"+(Number(list[i]*1).toString(16))).slice(-2).toUpperCase();
    }
    document.getElementsByClassName("result_text")[0].innerHTML = "#" + result;
    document.getElementsByClassName("result_color")[0].style.background = "#" + result;
  }

  // 十六进制转RGB
  function colorToRGB(value) {
    let result = "";
    if (value.length == 3) {
      for(let i = 0;i<value.length;i++) {
        result += eval("0x" + value[i] + value[i]).toString(10) + ", ";
      }
    } else {
      for(let i = 0;i<value.length;i += 2) {
        result += eval("0x" + value[i] + value[i+1]).toString(10) + ", ";
      }
    }
    result = result.substr(0, result.length - 2);
    document.getElementsByClassName("result_text")[1].innerHTML = result;
    document.getElementsByClassName("result_color")[1].style.background = "rgb(" + result + ")";
  }

  // 复制颜色
  function getResult(index) {
    let oInput = document.createElement("input")
    oInput.value = document.getElementsByClassName('result_text')[index].innerHTML;
    document.body.appendChild(oInput)
    oInput.select()
    document.execCommand("Copy")
    oInput.remove();
    document.getElementById("alert_window").style.display = "block";
    setTimeout(() => {
      document.getElementById("alert_window").style.display = "none";
    }, 1200)
  }
</script>

</body>
</html>